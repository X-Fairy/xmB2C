{"version":3,"sources":["webpack:///E:/项萍/熙美商城小程序/wxcomponents/hch-poster/hch-poster.vue?1491","webpack:///E:/项萍/熙美商城小程序/wxcomponents/hch-poster/hch-poster.vue?b854","webpack:///E:/项萍/熙美商城小程序/wxcomponents/hch-poster/hch-poster.vue?e06c","webpack:///E:/项萍/熙美商城小程序/wxcomponents/hch-poster/hch-poster.vue?faa4","uni-app:///wxcomponents/hch-poster/hch-poster.vue","webpack:///E:/项萍/熙美商城小程序/wxcomponents/hch-poster/hch-poster.vue?8ced","webpack:///E:/项萍/熙美商城小程序/wxcomponents/hch-poster/hch-poster.vue?eb47"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAuH;AACvH;AAC8D;AACL;AACc;;;AAGvE;AACkM;AAClM,gBAAgB,mMAAU;AAC1B,EAAE,gFAAM;AACR,EAAE,qFAAM;AACR,EAAE,8FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,yFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAqvB,CAAgB,kuBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;ACazwB;AACA,MADA,kBACA;AACA;;;AAGA,GALA;AAMA;AACA;AACA,mBADA;AAEA,mBAFA,EADA;;AAKA;AACA,gBADA;AAEA;AACA,eADA,EACA;AACA,gBAFA,EAEA;AACA,iBAHA,EAGA;AACA,yBAJA,EAIA;AACA,sBALA,EAKA;AACA,gBANA,CAMA;AANA,OAFA,EALA,EANA;;;AAuBA;AACA;AACA;AACA,aAHA,qBAGA,GAHA,EAGA,CAHA,EAGA,CAHA,EAGA,CAHA,EAGA,CAHA,EAGA,CAHA,EAGA,SAHA,EAGA,WAHA,EAGA,GAHA,EAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,yDADA,CACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OARA,MAQA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAvDA;;AAyDA;;;;;;;AAOA,uBAhEA,+BAgEA,GAhEA,EAgEA,IAhEA,EAgEA,YAhEA,EAgEA,UAhEA,EAgEA;AACA,qCADA,CACA;AACA;AACA;AACA;AACA;AACA;AACA,SAFA,MAEA;AACA,cADA,CACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAFA,MAEA;AACA;AACA;AACA;AACA,yBAfA,CAeA;AACA;AACA;AACA;AACA;AACA;AACA,KArGA;AAsGA;;;;AAIA;AACA,qBA3GA,+BA2GA;AACA;AACA,yBADA;;AAGA;AACA;AACA;AACA;AACA,qCARA,CAQA;AACA,qCATA,CASA;AACA;AACA,mCAXA,CAWA;AACA;AACA,4CAbA,CAaA;AACA;AACA;AACA,iBAhBA,CAgBA;AACA;AACA,4FAlBA,CAkBA;AACA,oBAnBA,CAmBA;AACA;AACA,6FArBA,CAqBA;AACA;AACA;;AAEA;AACA;AACA,gBADA;AAEA,eAFA,mBAEA,GAFA,EAEA;AACA;AACA;AACA;AACA;AACA,mBADA,EACA,SADA;AAEA;AACA,gBADA,EACA,EADA,EANA,CAOA;AACA;AACA;AACA,SAZA;AAaA,YAbA,gBAaA,GAbA,EAaA;AACA;AACA,SAfA;;;AAkBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BADA,CACA;AACA,oCAFA,CAEA;AACA,4BAHA,CAGA;AACA;AACA;AACA,gFANA,CAMA;AACA,+BAPA,CAOA;AACA,2BARA,CAQA;AACA,gCATA,CASA;AACA;AACA;AACA;AACA;AACA,OAdA,EAcA,GAdA;AAeA;;AAEA;AACA,0BA/EA,CA+EA;AACA,kCAhFA,CAgFA;AACA;AACA;AACA,0BAnFA,CAmFA;AACA;AACA;AACA;AACA;AACA,kDADA,CACA;AACA,4CAFA,CAEA;AACA,sDAHA,CAGA;AACA;AACA,OALA,MAKA;AACA,+CADA,CACA;AACA,+CAFA,CAEA;AACA,uDAHA,CAGA;AACA;AACA,wBALA,CAKA;AACA,4BANA,CAMA;AACA,iCAPA,CAOA;AACA,4DARA,CAQA;AACA,gFATA,CASA;AACA,qDAVA,CAUA;AACA,mEAXA,CAWA;AACA;AACA,qBAbA,CAaA;AACA,wBAdA,CAcA;AACA;AACA;AACA;AACA;AACA,mEADA,EACA;AACA;AACA,6DADA,EAFA;;AAKA;AACA,6CADA,EACA;AACA,gBAFA,EALA;;;AAUA,sBAVA;AAWA;AACA;AACA;AACA;AACA,oBADA;AAEA,mBAFA,mBAEA,GAFA,EAEA;AACA;AACA;AACA;AACA;AACA;AACA,aARA;AASA,gBATA,gBASA,GATA,EASA;AACA;AACA,aAXA;;;AAcA,SA5BA;AA6BA;AACA;AACA,SA/BA;;;;;AAoCA;AACA;AACA;AACA,kCArJA,CAqJA;AACA;AACA;AACA;AACA;AACA;AACA,kCA3JA,CA2JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BApKA,CAoKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KA7RA;;AA+RA;AACA,mBAhSA,6BAgSA;AACA;AACA,uBADA;;AAGA;AACA;AACA;AACA,aADA;AAEA,YAFA;AAGA,gCAHA,EAGA;AACA,iCAJA,EAIA;AACA,0CALA;AAMA,2CANA;AAOA,4BAPA;AAQA,eARA,mBAQA,GARA,EAQA;AACA;AACA;AACA,sCADA;AAEA,mBAFA,mBAEA,IAFA,EAEA;AACA;AACA,gCADA;AAEA,8BAFA;;AAIA;AACA;AACA,aATA;AAUA,gBAVA,gBAUA,GAVA,EAUA;AACA;AACA;AACA,kCADA;AAEA,8BAFA;AAGA,4BAHA;;AAKA;AACA,aAlBA;;AAoBA,SA9BA;AA+BA,YA/BA,gBA+BA,GA/BA,EA+BA;AACA;AACA,iCADA;AAEA,0BAFA;AAGA,wBAHA;;AAKA;AACA;AACA,SAvCA;;AAyCA,KA/UA;AAgVA;AACA,mBAjVA,6BAiVA;AACA;AACA,KAnVA,EAvBA,E;;;;;;;;;;;;;ACbA;AAAA;AAAA;AAAA;AAA22C,CAAgB,owCAAG,EAAC,C;;;;;;;;;;;ACA/3C;AACA,OAAO,KAAU,EAAE,kBAKd","file":"wxcomponents/hch-poster/hch-poster.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./hch-poster.vue?vue&type=template&id=0c452bff&\"\nvar renderjs\nimport script from \"./hch-poster.vue?vue&type=script&lang=js&\"\nexport * from \"./hch-poster.vue?vue&type=script&lang=js&\"\nimport style0 from \"./hch-poster.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"E:/项萍/熙美商城小程序/wxcomponents/hch-poster/hch-poster.vue\"\nexport default component.exports","export * from \"-!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./hch-poster.vue?vue&type=template&id=0c452bff&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./hch-poster.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./hch-poster.vue?vue&type=script&lang=js&\"","<template>\r\n\t<!-- 海报(想让海报显示隐藏要用hidden，v-if关闭后没办法在完整的出来海报) 保存海报按钮和关闭按钮 在html代码中写出来 绑定点击方法然后透明 再用canvas 覆盖 -->\r\n\t<view class=\"canvas_box\" :hidden=\"canvasFlag\">\r\n\t\t<view class=\"canvas_box_mask\"></view><!-- 遮罩 -->\r\n\t\t<icon type=\"cancel\" class=\"canvas_close_btn\" size=\"60\" @tap=\"canvasCancelEvn\" color=\"transparent\" /><!-- 关闭 -->\r\n\t\t<view class=\"button-wrapper\">\r\n\t\t\t<!-- 保存海报按钮 -->\r\n\t\t\t<cover-view class=\"save_btn\" @tap=\"saveCanvasImage\"></cover-view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\tprops: {\r\n\t\t\tcanvasFlag: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: true,\r\n\t\t\t},\r\n\t\t\tposterObj: {\r\n\t\t\t\ttype: null,\r\n\t\t\t\tdefault: {\r\n\t\t\t\t\turl: '', //商品主图\r\n\t\t\t\t\ticon: '', //会员价图标\r\n\t\t\t\t\ttitle: \"\", //标题\r\n\t\t\t\t\tdiscountPrice: \"\", //折后价格\r\n\t\t\t\t\torignPrice: \"\", //原价\r\n\t\t\t\t\tcode: '', //小程序码\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 海报\r\n\t\t\t// 画圆角矩形 ctx、x起点、y起点、w宽度、h高度、r圆角半径、fillColor填充颜色、strokeColor边框颜色\r\n\t\t\troundRect(ctx, x, y, w, h, r, fillColor, strokeColor, btn) {\r\n\t\t\t\t// 开始绘制\r\n\t\t\t\tctx.beginPath()\r\n\t\t\t\t// 绘制左上角圆弧 Math.PI = 180度\r\n\t\t\t\t// 圆心x起点、圆心y起点、半径、以3点钟方向顺时针旋转后确认的起始弧度、以3点钟方向顺时针旋转后确认的终止弧度\r\n\t\t\t\tctx.arc(x + r, y + r, r, Math.PI, Math.PI * 1.5)\r\n\t\t\t\t// 绘制border-top\r\n\t\t\t\t// 移动起点位置 x终点、y终点\r\n\t\t\t\tctx.moveTo(x + r, y)\r\n\t\t\t\t// 画一条线 x终点、y终点\r\n\t\t\t\tctx.lineTo(x + w - r, y)\r\n\t\t\t\t// 绘制右上角圆弧\r\n\t\t\t\tctx.arc(x + w - r, y + r, r, Math.PI * 1.5, Math.PI * 2)\r\n\t\t\t\t// 绘制border-right\r\n\t\t\t\tctx.lineTo(x + w, y + h - r)\r\n\t\t\t\t// 绘制右下角圆弧\r\n\r\n\t\t\t\tctx.arc(x + w - r, y + h - r, r, 0, Math.PI * 0.5)\r\n\r\n\t\t\t\t// 绘制左下角圆弧\r\n\r\n\t\t\t\tctx.arc(x + r, y + h - r, r, Math.PI * 0.5, Math.PI)\r\n\r\n\t\t\t\t// 绘制border-left\r\n\t\t\t\tctx.lineTo(x, y + r)\r\n\t\t\t\tif (btn == 'btn') {\r\n\t\t\t\t\tconst grd = ctx.createLinearGradient(0, 0, 200, 0) //渐变色\r\n\t\t\t\t\tgrd.addColorStop(0, fillColor)\r\n\t\t\t\t\tgrd.addColorStop(1, strokeColor)\r\n\t\t\t\t\t// 因为边缘描边存在锯齿，最好指定使用 transparent 填充\r\n\t\t\t\t\tctx.setFillStyle(grd)\r\n\t\t\t\t\t// 对绘画区域填充\r\n\t\t\t\t\tctx.fill()\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tif (fillColor) {\r\n\t\t\t\t\t\t// 因为边缘描边存在锯齿，最好指定使用 transparent 填充\r\n\t\t\t\t\t\tctx.setFillStyle(fillColor)\r\n\t\t\t\t\t\t// 对绘画区域填充\r\n\t\t\t\t\t\tctx.fill()\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (strokeColor) {\r\n\t\t\t\t\t\t// 因为边缘描边存在锯齿，最好指定使用 transparent 填充\r\n\t\t\t\t\t\tctx.setStrokeStyle(strokeColor)\r\n\t\t\t\t\t\t// 画出当前路径的边框\r\n\t\t\t\t\t\tctx.stroke()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// 关闭一个路径\r\n\t\t\t\tctx.closePath()\r\n\t\t\t\t// 剪切，剪切之后的绘画绘制剪切区域内进行，需要save与restore 这个很重要 不然没办法保存\r\n\t\t\t\tctx.clip()\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * canvas绘图相关，把文字转化成只能行数，多余显示省略号\r\n\t\t\t * ctx: 当前的canvas\r\n\t\t\t * text: 文本\r\n\t\t\t * contentWidth: 文本最大宽度\r\n\t\t\t * lineNumber: 显示几行\r\n\t\t\t */\r\n\t\t\tcanvasMultiLineText(ctx, text, contentWidth, lineNumber) {\r\n\t\t\t\tvar textArray = text.split(\"\"); // 分割成字符串数组\r\n\t\t\t\tvar temp = \"\";\r\n\t\t\t\tvar row = [];\r\n\t\t\t\tfor (let i = 0; i < textArray.length; i++) {\r\n\t\t\t\t\tif (ctx.measureText(temp).width < contentWidth) {\r\n\t\t\t\t\t\ttemp += textArray[i];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ti--; // 这里添加i--是为了防止字符丢失\r\n\t\t\t\t\t\trow.push(temp);\r\n\t\t\t\t\t\ttemp = \"\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\trow.push(temp);\r\n\r\n\t\t\t\t// 如果数组长度大于2，则截取前两个\r\n\t\t\t\tif (row.length > lineNumber) {\r\n\t\t\t\t\tconsole.log(row.length, lineNumber)\r\n\t\t\t\t\tvar rowCut = row.slice(0, lineNumber);\r\n\t\t\t\t\tconsole.log(row);\r\n\t\t\t\t\tvar rowPart = row[0];\r\n\t\t\t\t\tconsole.log(rowPart)\r\n\t\t\t\t\tvar test = \"\";\r\n\t\t\t\t\tvar empty = [];\r\n\t\t\t\t\tfor (var a = 0; a < rowPart.length; a++) {\r\n\t\t\t\t\t\tif (ctx.measureText(test).width < contentWidth) {\r\n\t\t\t\t\t\t\ttest += rowPart[a];\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tempty.push(test); // 处理后面加省略号\r\n\t\t\t\t\tvar group = empty[0] + '...'\r\n\t\t\t\t\trowCut.splice(lineNumber - 1, 1, group);\r\n\t\t\t\t\trow = rowCut;\r\n\t\t\t\t}\r\n\t\t\t\treturn row;\r\n\t\t\t},\r\n\t\t\t// 获取海报的小程序码 -->\r\n\r\n\r\n\r\n\t\t\t// 生成海报\r\n\t\t\tcreateCanvasImage() {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '海报生成中...'\r\n\t\t\t\t})\r\n\t\t\t\tlet _this = this;\r\n\t\t\t\tlet phoneData = uni.getSystemInfoSync();\r\n\t\t\t\tthis.phoneH = phoneData.windowHeight;\r\n\t\t\t\tthis.phoneW = phoneData.windowWidth;\r\n\t\t\t\tlet scaleW = this.phoneW / 375; //按照苹果留 375*667比例 其他型号手机等比例缩放 显示\r\n\t\t\t\tlet scaleH = this.phoneH / 667; //按照苹果留 375*667比例 其他型号手机等比例缩放 显示\r\n\t\t\t\tconst ctx = uni.createCanvasContext('myCanvas');\r\n\t\t\t\tlet url = this.posterObj.url; //商品主图\r\n\t\t\t\tconsole.log(this.posterObj)\r\n\t\t\t\tlet zpPriceIcon = this.posterObj.icon //图标\r\n\t\t\t\tlet code = this.posterObj.code\r\n\t\t\t\tlet closeBtn = this.posterObj.close\r\n\t\t\t\tctx.draw() //清空原来的画图内容\r\n\t\t\t\tctx.save();\r\n\t\t\t\tthis.roundRect(ctx, 50, 40, (this.phoneW - 100), (this.phoneH - 200), 10, '#fff', '#fff'); //绘制海报圆角背景白色的\r\n\t\t\t\tctx.restore(); //恢复之前保存的绘图上下文 恢复之前保存的绘图上下午即状态 可以继续绘制\r\n\t\t\t\tctx.save();\r\n\t\t\t\tthis.roundRect(ctx, 50, 40, (this.phoneW - 100), (340) * scaleH, 10, '#f7f7f7', '#f7f7f7'); //绘制海报圆角背景 上半截灰色的\r\n\t\t\t\tctx.restore();\r\n\t\t\t\turl = 'https' + url.slice(4, url.length);\r\n\r\n\t\t\t\t//将网络图片转成本地路径 商品图片\r\n\t\t\t\tuni.getImageInfo({\r\n\t\t\t\t\tsrc: url,\r\n\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\tctx.save();\r\n\t\t\t\t\t\tconsole.log(res.path, 1);\r\n\t\t\t\t\t\t_this.posterObj.url = res.path;\r\n\t\t\t\t\t\t_this.roundRect(ctx, (_this.phoneW - ((_this.phoneW - 130))) / 2, 55, (_this.phoneW - 130), 250 * scaleH, 10,\r\n\t\t\t\t\t\t\t'#f7f7f7', '#f7f7f7')\r\n\t\t\t\t\t\tctx.drawImage(_this.posterObj.url, (_this.phoneW - ((_this.phoneW - 130))) / 2, 55, (_this.phoneW - 130), 250 *\r\n\t\t\t\t\t\t\tscaleH, 10); //绘制图\r\n\t\t\t\t\t\tctx.restore();\r\n\t\t\t\t\t\tctx.draw(true)\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail(err) {\r\n\t\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\r\n\t\t\t\t// 关闭按钮\r\n\t\t\t\t// uni.getImageInfo({\r\n\t\t\t\t// \tsrc: closeBtn,\r\n\t\t\t\t// \tsuccess(res) {\r\n\t\t\t\t// \t\tcloseBtn=res.path;\r\n\t\t\t\t// \t\tctx.drawImage(closeBtn, 50 + (_this.phoneW - 100) + 5, 40, 24, 24)\r\n\t\t\t\t// \t\tctx.draw(true)\r\n\t\t\t\t// \t},\r\n\t\t\t\t// \tfail(err) {\r\n\t\t\t\t// \t\t_this.canvasFlag = true;\r\n\t\t\t\t// \t\tconsole.log(err);\r\n\t\t\t\t// \t}\r\n\t\t\t\t// })\r\n\t\t\t\tctx.drawImage(closeBtn, 50 + (_this.phoneW - 100) + 5, 40, 24, 24)\r\n\t\t\t\tctx.draw(true)\r\n\t\t\t\t// 关闭按钮 end\r\n\t\t\t\t// 海报商品title\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tctx.setGlobalAlpha(1) //不透明\r\n\t\t\t\t\tctx.setFillStyle('#1c1c1c') //文字颜色：默认黑色\r\n\t\t\t\t\tctx.setFontSize(14) //设置字体大小，默认10\r\n\t\t\t\t\tctx.font = 'normal bold 14px sans-serif';\r\n\t\t\t\t\tlet text = this.posterObj.title;\r\n\t\t\t\t\tlet row = this.canvasMultiLineText(ctx, text, (this.phoneW - 130), 1); //计算绘制的2行文本\r\n\t\t\t\t\tlet contentTextY = 350; // 这段文字起始的y位置\r\n\t\t\t\t\tlet leftSpace = 65; // 这段文字起始的X位置\r\n\t\t\t\t\tlet textLineHeight = 18; // 一行文字加一行行间距\r\n\t\t\t\t\tfor (let b = 0; b < row.length; b++) { //一行一行绘制文本\r\n\t\t\t\t\t\tctx.fillText(row[b], leftSpace, (contentTextY + textLineHeight * b - 15) * scaleH, (this.phoneW - 130));\r\n\t\t\t\t\t\tctx.draw(true)\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 500)\r\n\t\t\t\t// 海报商品title end\r\n\r\n\t\t\t\t//绘制价格\r\n\t\t\t\tctx.setFontSize(12) //设置字体大小，默认10\r\n\t\t\t\tctx.setFillStyle('#c00000') //文字颜色：默认黑色\r\n\t\t\t\tctx.font = 'normal 12px sans-serif';\r\n\t\t\t\tctx.fillText('￥', 60, 360 * scaleH, 60);\r\n\t\t\t\tctx.setFontSize(16) //设置字体大小，默认10\r\n\t\t\t\tconsole.log(this.posterObj.discountPrice);\r\n\t\t\t\tlet orignPrice;\r\n\t\t\t\tlet zpPrice\r\n\t\t\t\tif (this.posterObj.discountPrice == 0) {\r\n\t\t\t\t\torignPrice = this.posterObj.discountPrice; //会员价格\r\n\t\t\t\t\tzpPrice = this.posterObj.orignPrice; //市场价\t\r\n\t\t\t\t\tlet zpPriceW = ctx.measureText(zpPrice).width; //文本的宽度\r\n\t\t\t\t\tctx.fillText(zpPrice, 70, 360 * scaleH, zpPriceW);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tzpPrice = this.posterObj.discountPrice; //会员价格\r\n\t\t\t\t\torignPrice = this.posterObj.orignPrice; //市场价\t\r\n\t\t\t\t\tlet zpPriceW = ctx.measureText(zpPrice).width; //文本的宽度\r\n\t\t\t\t\tctx.fillText(zpPrice, 70, 360 * scaleH, zpPriceW);\r\n\t\t\t\t\tctx.beginPath(); //开始一个新的路径\r\n\t\t\t\t\tctx.setFontSize(13) //设置字体大小，默认10\r\n\t\t\t\t\tctx.setFillStyle('#999') //文字颜色：默认黑色\r\n\t\t\t\t\tlet orignPriceW = ctx.measureText(orignPrice).width //去掉市场价\r\n\t\t\t\t\tctx.fillText(orignPrice, 70 + zpPriceW + 5, 360 * scaleH, orignPriceW); //5价格间距\r\n\t\t\t\t\tctx.moveTo(70 + zpPriceW + 5, 355 * scaleH); //设置线条的起始路径坐标\r\n\t\t\t\t\tctx.lineTo(70 + zpPriceW + 5 + orignPriceW, 355 * scaleH); //设置线条的终点路径坐标\r\n\t\t\t\t\tctx.setStrokeStyle('#999')\r\n\t\t\t\t\tctx.stroke(); //对当前路径进行描边\r\n\t\t\t\t\tctx.closePath(); //关闭当前路径\r\n\t\t\t\t}\r\n\t\t\t\t//绘制价格 end\r\n\t\t\t\tlet id = this.posterObj.id\r\n\t\t\t\tuni.request({\r\n\t\t\t\t\turl: \"https://dh.xmvogue.com/index.php/API/Index/sharecode\", //域名省略\t\r\n\t\t\t\t\theader: {\r\n\t\t\t\t\t\t'content-type': 'application/x-www-form-urlencoded'\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tpath: 'pages/goods/goods?gid=' + id, //想要生成小程序码的页面地址\r\n\t\t\t\t\t\tid: id\r\n\r\n\t\t\t\t\t},\r\n\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\tsuccess: function(res) {\r\n\t\t\t\t\t\tlet img = 'https' + res.data.slice(4, res.data.length) + \"?x-oss-process=style/300\";\r\n\t\t\t\t\t\tconsole.log(img)\r\n\t\t\t\t\t\tuni.getImageInfo({\r\n\t\t\t\t\t\t\tsrc: img,\r\n\t\t\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t\t\t\t\t_this.posterObj.code = res.path;\r\n\t\t\t\t\t\t\t\tctx.drawImage(_this.posterObj.code, (_this.phoneW - 80) / 2, 390 * scaleH, 80, 80)\r\n\t\t\t\t\t\t\t\t// ctx.restore(); //恢复之前保存的绘图上下文 恢复之前保存的绘图上下午即状态 可以继续绘制\r\n\t\t\t\t\t\t\t\tctx.draw(true)\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tfail(err) {\r\n\t\t\t\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: function(err) {\r\n\t\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t})\r\n\r\n\r\n\t\t\t\t// 小程序码end\r\n\t\t\t\t// 小程序的名称\r\n\t\t\t\tctx.setFontSize(14)\r\n\t\t\t\tctx.setFillStyle('#2f1709') //文字颜色：默认黑色\r\n\t\t\t\tctx.font = 'normal bold 14px sans-serif';\r\n\t\t\t\t// ctx.fillText('小程序的名称', (_this.phoneW - 90) / 2, 530 * scaleH, 90);\r\n\t\t\t\t// 小程序的名称end\r\n\t\t\t\t// 长按/扫描识别查看商品\r\n\t\t\t\tctx.setFontSize(14)\r\n\t\t\t\tctx.setFillStyle('#ff5f33') //文字颜色：默认黑色\r\n\t\t\t\tctx.font = 'normal 14px sans-serif';\r\n\t\t\t\tctx.fillText('长按/扫描识别查看商品', (_this.phoneW - 140) / 2, 490 * scaleH, 140);\r\n\t\t\t\t// 长按/扫描识别查看商品end\r\n\t\t\t\t//绘制保存按钮\r\n\t\t\t\tctx.save();\r\n\t\t\t\tthis.roundRect(ctx, (this.phoneW - 160) / 2, (this.phoneH - 55), 160, 36, 18, '#ff3600', '#ff6a00', 'btn')\r\n\t\t\t\tctx.restore();\r\n\t\t\t\tctx.setFontSize(14)\r\n\t\t\t\tctx.setFillStyle('#fff') //文字颜色：默认黑色\r\n\t\t\t\tctx.font = 'normal bold 14px sans-serif';\r\n\t\t\t\tctx.fillText('保存图片', (_this.phoneW - 58) / 2, (this.phoneH - 33), 58);\r\n\t\t\t\t//绘制保存按钮 end\r\n\t\t\t\tuni.hideLoading();\r\n\t\t\t\t// ctx.save();\r\n\t\t\t\t// this.roundRect(ctx, (this.phoneW - 160) / 2, (this.phoneH - 140), 160, 36, 18, '#ff3600', '#ff6a00', 'btn')\r\n\t\t\t\t// ctx.restore();\r\n\t\t\t\t// ctx.setFontSize(14)\r\n\t\t\t\t// ctx.setFillStyle('#fff') //文字颜色：默认黑色\r\n\t\t\t\t// ctx.font = 'normal bold 14px sans-serif';\r\n\t\t\t\t// ctx.fillText('保存图片', (_this.phoneW - 58) / 2, (this.phoneH - 118), 58);\r\n\t\t\t\t// //绘制保存按钮 end\r\n\t\t\t\t// uni.hideLoading();\r\n\t\t\t},\r\n\r\n\t\t\t// 保存到系统相册\r\n\t\t\tsaveCanvasImage() {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '保存中...'\r\n\t\t\t\t})\r\n\t\t\t\tlet _this = this;\r\n\t\t\t\t// 1-把画布转化成临时文件\r\n\t\t\t\tuni.canvasToTempFilePath({\r\n\t\t\t\t\tx: 50,\r\n\t\t\t\t\ty: 0,\r\n\t\t\t\t\twidth: (this.phoneW - 100), // 画布的宽\r\n\t\t\t\t\theight: (this.phoneH - 120), // 画布的高\r\n\t\t\t\t\tdestWidth: (this.phoneW - 100) * 5,\r\n\t\t\t\t\tdestHeight: (this.phoneH - 120) * 5,\r\n\t\t\t\t\tcanvasId: 'myCanvas',\r\n\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\t// 2-保存图片至相册\r\n\t\t\t\t\t\tuni.saveImageToPhotosAlbum({\r\n\t\t\t\t\t\t\tfilePath: res.tempFilePath,\r\n\t\t\t\t\t\t\tsuccess(res2) {\r\n\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\ttitle: '图片保存成功!',\r\n\t\t\t\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\t\t\t_this.canvasCancelEvn();\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tfail(err) {\r\n\t\t\t\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\ttitle: '保存失败，稍后再试',\r\n\t\t\t\t\t\t\t\t\tduration: 2000,\r\n\t\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t// uni.hideLoading();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail(err) {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '保存失败，稍后再试111',\r\n\t\t\t\t\t\t\tduration: 2000,\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 取消海报\r\n\t\t\tcanvasCancelEvn() {\r\n\t\t\t\tthis.$emit('cancel', true)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n\t.content {\r\n\t\ttext-align: center;\r\n\t\theight: 100%;\r\n\t}\r\n\r\n\t.canvas_box {\r\n\t\t.canvas_box_mask {\r\n\t\t\twidth: 100%;\r\n\t\t\theight: 100%;\r\n\t\t\tposition: fixed;\r\n\t\t\ttop: 0;\r\n\t\t\tright: 0;\r\n\t\t\tbottom: 0;\r\n\t\t\tleft: 0;\r\n\t\t\tbackground: rgba(0, 0, 0, 0.5);\r\n\t\t\tz-index: 9;\r\n\t\t}\r\n\r\n\t\t.canvas {\r\n\t\t\tposition: fixed !important;\r\n\t\t\ttop: 0 !important;\r\n\t\t\tleft: 0 !important;\r\n\t\t\tdisplay: block !important;\r\n\t\t\twidth: 100% !important;\r\n\t\t\theight: 100% !important;\r\n\t\t\tz-index: 9;\r\n\t\t}\r\n\r\n\t\t.button-wrapper {\r\n\t\t\twidth: 320rpx;\r\n\t\t\theight: 72rpx;\r\n\t\t\tposition: absolute;\r\n\t\t\tbottom: 20rpx;\r\n\t\t\tleft: 215rpx;\r\n\t\t\tz-index: 16;\r\n\t\t}\r\n\r\n\t\t.save_btn {\r\n\t\t\tfont-size: 30rpx;\r\n\t\t\tline-height: 72rpx;\r\n\t\t\tcolor: #fff;\r\n\t\t\twidth: 100%;\r\n\t\t\theight: 100%;\r\n\t\t\ttext-align: center;\r\n\t\t\tborder-radius: 45rpx;\r\n\t\t\tborder-radius: 36rpx;\r\n\t\t\tz-index: 10;\r\n\t\t}\r\n\r\n\t\t.canvas_close_btn {\r\n\t\t\tposition: fixed;\r\n\t\t\ttop: 30rpx;\r\n\t\t\tright: 0;\r\n\t\t\tz-index: 12;\r\n\r\n\t\t}\r\n\t}\r\n</style>\n","import mod from \"-!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./hch-poster.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\我的资料库\\\\Documents\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./hch-poster.vue?vue&type=style&index=0&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1591432558422\n      var cssReload = require(\"D:/我的资料库/Documents/Downloads/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}